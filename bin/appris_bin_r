#!/bin/bash

# -----------------------------------------------------------------------------
# Usage

USAGE="
\n
 APPRIS's binary for dev.\n
\n
 Name:\n
\t appris_bin\n
\n
 Description:\n
\t script that insert the APPRIS results of a gene into DB.\n
\n
Optional arguments:\n
\t -i Path where input data is located\n
\n
\t -m {Methods which will execute. By default, all}\n
\t\t f -> firestar\n
\t\t m -> matador3d\n
\t\t s -> spade\n
\t\t c -> corsair\n
\t\t t -> thump\n
\t\t r -> crash\n
\t\t p -> proteo\n
\t\t a -> appris\n
\n
\t -l \n
\t\t info\n
\t\t debug\n
\n
\t -h \n
\n
Example:\n
\t\t appris_ibin -s 'Homo sapiens' -m fmscrp
\n
\n
 Author: Jose Manuel Rodriguez Carrasco -jmrodriguez@cnio.es- (INB-GN2,CNIO)\n
\n
"

# -----------------------------------------------------------------------------
# Get input parameters

ALL_METHOD="firestar,matador3d,spade,corsair,thump,crash,proteo"
INPATH="${PWD}"
LOG_LEVEL="info"

while expr "//$1" : //- >/dev/null
do
	case "$1" in
		-i )
			INPATH=$2
			shift
			;;
		-m )
			METHODS=$2
			shift
			;;
		-l )
			case "$2" in
				info | debug )
		        	LOG_LEVEL=$2
					;;
				* )
					echo Unknown loglevel: "$2" 
					echo -e $USAGE
					exit 1
					;;
			esac
			shift
			;;			
		-h | -help )
			echo -e $USAGE		
			exit
			;;
		* )
			echo Unknown option: "$1"
			echo -e $USAGE
			exit 1
			;;
	esac
	shift
done

METHODS_PARAM=""
if [ "${METHODS}" != "" ]; then
	MET=""
	if [[ "${METHODS}" == *"f"* ]]; then
		MET="${MET},firestar"
	fi
	if [[ "${METHODS}" == *"m"* ]]; then
		MET="${MET},matador3d"
	fi
	if [[ "${METHODS}" == *"s"* ]]; then
		MET="${MET},spade"
	fi
	if [[ "${METHODS}" == *"c"* ]]; then
		MET="${MET},corsair"
	fi
	if [[ "${METHODS}" == *"t"* ]]; then
		MET="${MET},thump"
	fi
	if [[ "${METHODS}" == *"r"* ]]; then
		MET="${MET},crash"
	fi
	if [[ "${METHODS}" == *"p"* ]]; then
		MET="${MET},proteo"
	fi	
	if [[ "${METHODS}" == *"a"* ]]; then
		MET="${MET},appris"
	fi	
	METHODS_PARAM="${MET:1}"
else
	METHODS_PARAM="${ALL_METHOD}"
fi

METHOD_SCRIPT="retrieve_method_data.pl"
SCRIPT="${APPRIS_SCRIPTS_DIR}/${METHOD_SCRIPT}"

SPECIES="APPRIS test"
APPRIS_SCRIPTS_DB_INI="${APPRIS_SCRIPTS_CONF_DIR}/apprisdb.test.ini"
FORMAT_LIST="gtf bed"
OUTPUT_FILE="appris_method.test"

# -----------------------------------------------------------------------------
# Run method

for FORMAT in ${FORMAT_LIST}; do
	# print trace
	echo "================="
	echo "perl ${SCRIPT} \\ "
	echo " --species=\"${SPECIES}\" \\ "
	echo " --methods=${METHODS_PARAM} \\ "
	echo " --format=${FORMAT} \\ "
	echo " --apprisdb-conf=${APPRIS_SCRIPTS_DB_INI} \\ "
	echo " --output=${OUTPUT_FILE} \\ "
	echo " --loglevel=${LOG_LEVEL}\ "
	
	# run method
	perl ${SCRIPT} \
	--species="${SPECIES}" \
	--methods=${METHODS_PARAM} \
	--format=${FORMAT} \
	--apprisdb-conf=${APPRIS_SCRIPTS_DB_INI} \
	--output=${OUTPUT_FILE} \
	--loglevel=${LOG_LEVEL}
	echo "================="
done

